	; Batronix Assembler File
	; -------------------------------------------------------------
	; Version:       1.0
	; Revision:
	; Author:         tiesen243
	; Creation Time:  20-Jun-24 05:43:17
	; Description:    lorem
	; -------------------------------------------------------------

	$INCLUDE "Common\89C52.mc"
	;        -------------------------------------------------------------
	;        Batronix Assembler Source Generator
	;        -------------------------------------------------------------

	; ------------------------s-------------------------------------
	; Program start
	; -------------------------------------------------------------

	ORG 0h
	JMP Initialize

	; -------------------------------------------------------------
	; Interrupts
	; -------------------------------------------------------------

	;        -------------------------------------------------------------
	;        Includes
	;        -------------------------------------------------------------
	ORG      0FFFFF800H; here begins the usabe memory of the community version
	$INCLUDE declarations.asm

	; -------------------------------------------------------------
	; Initialize program
	; -------------------------------------------------------------

Initialize:
	MOV SP, #40H

	; -------------------------------------------------------------
	; Main program
	; -------------------------------------------------------------

	; Expected: P1.0 - P1.7:
	; 0000 0000 -> 1000 0000 -> 0100 0000 -> 0010 0000 -> 0001 0000 -> 0000 1000 -> 0000 0100 -> 0000 0010 -> 0000 0001
	; -> 1000 0001 -> 0100 0001 -> 0010 0001 -> 0001 0001 -> 0000 1001 -> 0000 0101 -> 0000 0011
	; -> 1000 0011 -> 0100 0011 -> 0010 0011 -> 0001 0011 -> 0000 1011 -> 0000 0111
	; -> 1000 0111 -> 0100 0111 -> 0010 0111 -> 0001 0111 -> 0000 1111
	; -> 1000 1111 -> 0100 1111 -> 0010 1111 -> 0001 1111
	; -> 1001 1111 -> 0101 1111 -> 0011 1111
	; -> 1011 1111 -> 0111 1111
	; -> 1111 1111

Main:
	; ---------- Define port ----------

	STORE EQU 20H
	TEMP  EQU 21H

	MOV tmod, #10h
	MOV STORE, #00h

TD:
	MOV  P1, STORE
	MOV  A, #00h
	SETB C

L1:
	RRC A
	MOV TEMP, A
	;   A = 1000 0000, STORE = 0000 0001 -> TEMP = 1000 0001
	;   Set temp

	MOV   P1, TEMP
	LCALL DELAY
	JNB   C, L1

	;   store the value of p1 in the store variable
	MOV STORE, P1

	SJMP TD

	; ---------- Delay function ----------

DELAY:
	MOV R7, #30

DEL:
	MOV  th1, #0d8h
	MOV  tl1, #0f0h
	SETB tr1
	JNB  tf1, $
	CLR  tr1
	CLR  tf1
	DJNZ R7, Del
	RET

End

	; -------------------------------------------------------------
	; End of program
	; -------------------------------------------------------------

Finalize:
	JMP finalize

	; -------------------------------------------------------------
	; Data
	; -------------------------------------------------------------
